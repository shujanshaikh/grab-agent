var GrabIt=(function(exports){'use strict';var m=`http://localhost:5678`,E="grab-it:agent-sessions",b=r=>{let t="",o="";for(let e of r.split(`
`))e.startsWith("event:")?t=e.slice(6).trim():e.startsWith("data:")&&(o=e.slice(5).trim());return {eventType:t,data:o}};async function*y(r,t){let o=r.getReader(),e=new TextDecoder,s="",n=false,a=()=>{n=true,o.cancel().catch(()=>{});};t.addEventListener("abort",a);try{if(t.aborted)throw new DOMException("Aborted","AbortError");for(;;){let i=await o.read();if(n||t.aborted)throw new DOMException("Aborted","AbortError");let{done:l,value:p}=i;p&&(s+=e.decode(p,{stream:!0}));let c;for(;(c=s.indexOf(`

`))!==-1;){let{eventType:d,data:g}=b(s.slice(0,c));if(s=s.slice(c+2),d==="done")return;if(d==="error"){console.error("[react-grab]",g||"Agent error");return}g&&(yield g);}if(l)break}}finally{t.removeEventListener("abort",a);try{o.releaseLock();}catch{}}}async function*f(r,t,o){let e=await fetch(`${r}/agent`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),signal:o});if(!e.ok)throw new Error(`Server error: ${e.status}`);if(!e.body)throw new Error("No response body");yield*y(e.body,o);}var S=(r={})=>{let{serverUrl:t=m,getOptions:o}=r,e=null,s=n=>({...o?.()??{},...n??{}});return {send:async function*(n,a){let i={...n,options:s(n.options)};yield*f(t,i,a);},resume:async function*(n,a,i){let l=i.getItem(E);if(!l)throw new Error("No sessions to resume");let c=JSON.parse(l)[n];if(!c)throw new Error(`Session ${n} not found`);let d=c.context,g={...d,options:s(d.options)};yield "Resuming...",yield*f(t,g,a);},supportsResume:true,checkConnection:async()=>{let n=Date.now();if(e&&n-e.timestamp<5e3)return e.result;try{let i=(await fetch(`${t}/`,{method:"GET"})).ok;return e={result:i,timestamp:n},i}catch{return e={result:false,timestamp:n},false}},undo:async()=>{try{await fetch(`${t}/undo`,{method:"POST"});}catch{}}}},w=async()=>{if(typeof window>"u")return;let r=S(),t=window.__REACT_GRAB__;if(t){t.setAgent({provider:r,storage:sessionStorage});return}window.addEventListener("react-grab:init",o=>{o.detail.setAgent({provider:r,storage:sessionStorage});},{once:true});};w();exports.attachAgent=w;exports.createKaiAgentProvider=S;return exports;})({});